
# じゃんけんポーズ出力プログラム

じゃんけんのグーチョキパーを表示するプログラム

## 環境

* H/W
  * NUCLEO-F401RE
  * IM315-SHLD-RX-V2 + IM920s
* S/W
  * VSCodeのPlatform IO (ArduinoIDEでもいける？)
  * STM32duino
* Teraterm等のターミナルソフト(任意)

## 使い方

* 通常モード
  * 電源を入れると通常モードで起動します
  * 送信側は100ms間隔でデータ送信してきます
  * USB経由(115200bps)で送信側のAD値に基づく、  
    じゃんけんの手を出力します  
    * 実際にはじゃんけんポンのタイミングでJKN_EnableIdentify()を  
      実行して判断を開始してください
  * usbrx_procで定義されたコマンドで各種パラメータを変更できます  
    | コマンド名| 詳細         |
    |:-----|:-----------------|
    | RDALL| 全パラメータ出力|
    | SWRST| マイコン再起動|
    | PMCLR| 全パラメータ初期化|
    | WRMDL| 中指の閾値を設定(10進数5桁50296以下)|
    | WRRNG| 薬指の閾値を設定(10進数5桁50296以下)</br>AD値のみ表示する|
    | ENDSP| 受信データを表示|
    | DSDSP| 受信データを非表示|
    | SETIM| IM920s設定モードへ|
    | GOAVG| 平均計測モードへ|
    | WRAVG| 平均計測モードの回数を指定|

* IM920s設定モード
  * 通常モードで起動した後、SETIM\<CR>\<LF>と  
    入力するとこのモードに入ります
  * IM920sのパラメータ等を書き換えることができます

* 平均計測モード
  * 通常モードで起動した後、GOAVG\<CR>\<LF>と  
    入力するとこのモードに入ります
  * 以下の流れで動作を行います
  * まず\<CR>\<LF>を入力待ちます(Enterキー入力までに右手を測定したいポーズにしてください)
    * このときその他コマンドは使うことができません
  * 入力があるとWRAVGで設定したパケット数を待ちます(右手は上と同じポーズで固定してください)
  * その後各ADポートの平均値、最大値、最小値を出力します(この値を閾値に役立ててください)
  * その後通常モードへ戻ります

## ファイル

| ファイル名                | 詳細         |
|:------------------------|:--------------------------------|
| main.cpp                | メインファイル                   |
| janken_proc.cpp         | じゃんけんの手を識別する          |
| im920_pro.cpp           | 無線データを解析してAD値を取り出す |
| usbrx_proc.cpp          | USBからのコマンドを解析する       |
| drv_usbSTM32duino.cpp   | USBからの受信割り込みを設定する   |
| drv_flashSTM32duino.cpp | STM32の内蔵Flashへパラメータ読み書きする</br> (L476,F401に対応。F411は多分いけるけど未確認)|
| drv_timerSTM32duino.cpp | STM32のH/Wタイマーを設定する|
